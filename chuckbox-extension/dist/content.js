function s(){const t=window.location.href.toLowerCase();return t.includes("advancements.scouting.org")&&(t.includes("/roster")||t.includes("/unit"))}function m(){x();const t=document.querySelector('main, .main-content, #content, [role="main"]');if(t)return t.innerHTML;const o=document.body.cloneNode(!0);return o.querySelectorAll("nav, header, footer, .navigation, .sidebar").forEach(n=>{n.remove()}),o.innerHTML}function x(){document.querySelectorAll("td[title], th[title]").forEach(e=>{const a=e.getAttribute("title");a&&a.trim()&&e.setAttribute("data-hover-text",a)}),document.querySelectorAll("[data-tooltip], [data-tip], [aria-label]").forEach(e=>{const a=e.getAttribute("data-tooltip")||e.getAttribute("data-tip")||e.getAttribute("aria-label");a&&a.trim()&&e.setAttribute("data-hover-text",a)}),document.querySelectorAll('.ant-tooltip-open, [class*="ant-tooltip"]').forEach(e=>{const a=e.querySelector(".ant-tooltip-inner");a&&e.setAttribute("data-hover-text",a.textContent||"")})}function w(){return[".ant-pagination",".ant-pagination-next",'[aria-label="pagination"]',".pagination",'[class*="pagination"]'].some(o=>document.querySelector(o)!==null)}function y(){const t=document.querySelector(".ant-pagination-next:not(.ant-pagination-disabled)");if(t&&t.getAttribute("aria-disabled")!=="true")return t;const o=['button[aria-label*="Next"]','a[aria-label*="Next"]','li[title="Next Page"]:not([aria-disabled="true"])',".pagination-next:not(.disabled)"];for(const n of o){const e=document.querySelector(n);if(e)return e}return null}function c(t){return new Promise(o=>setTimeout(o,t))}function p(){const t=document.querySelector(".ant-pagination-prev");if(t)return t.classList.contains("ant-pagination-disabled")||t.getAttribute("aria-disabled")==="true";const o=document.querySelector(".ant-pagination-item-active");return o?o.getAttribute("title")==="1":!0}async function C(){if(p()){console.log("[Chuckbox] Already on first page");return}console.log("[Chuckbox] Navigating to first page...");const t=document.querySelector(".ant-pagination-item-1");if(t){t.click(),await l(),await c(500),console.log("[Chuckbox] Clicked page 1 button");return}let o=20;for(;o>0&&!p();){const n=document.querySelector(".ant-pagination-prev:not(.ant-pagination-disabled)");if(!n||n.getAttribute("aria-disabled")==="true")break;n.click(),await l(),await c(300),o--}console.log("[Chuckbox] Navigated to first page")}function l(t=5e3){return new Promise(o=>{let n=!1;const e=new MutationObserver((a,r)=>{a.some(i=>{var b;const d=i.target,g=(b=d.tagName)==null?void 0:b.toLowerCase(),f=d.className||"";return i.type==="childList"&&(g==="tbody"||g==="table"||f.includes("ant-table")||f.includes("ant-spin"))})&&!n&&(n=!0,r.disconnect(),setTimeout(o,500))});e.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{n||(n=!0,e.disconnect(),o())},t)})}async function v(){const t=[];w()&&await C(),t.push(m()),console.log("[Chuckbox] Extracted page 1");let o=1;const n=20;for(;o<n;){const e=y();if(!e){console.log("[Chuckbox] No more pages (next button not found or disabled)");break}await c(300),console.log("[Chuckbox] Clicking next page..."),e.click(),await l(),await c(500);const a=m(),r=t[t.length-1];if(a.length===r.length&&a===r){console.log("[Chuckbox] Page content unchanged, stopping");break}o++,t.push(a),console.log(`[Chuckbox] Extracted page ${o}`)}return console.log(`[Chuckbox] Total pages extracted: ${t.length}`),t.join(`
<!-- PAGE BREAK -->
`)}function k(){var i;const t=document.body.innerText.match(/(\d+)\s*(?:member|scout|roster)/i),o=t?parseInt(t[1],10):null,n=document.querySelector('h1, h2, [class*="unit-name"], [class*="title"]'),e=((i=n==null?void 0:n.textContent)==null?void 0:i.trim())||null,a=document.body.innerText.match(/page\s*(\d+)\s*of\s*(\d+)/i),r=a?parseInt(a[1],10):null,u=a?parseInt(a[2],10):null;return{memberCount:o,unitName:e,pageNumber:r,totalPages:u}}chrome.runtime.onMessage.addListener((t,o,n)=>{if(t.action==="ping")return n({isRosterPage:s(),url:window.location.href}),!0;if(t.action==="getInfo"){const e=k();return n(e),!0}return t.action==="extract"?(P().then(e=>n(e)).catch(e=>{n({success:!1,error:e instanceof Error?e.message:"Unknown error"})}),!0):!1});async function P(){if(!s())return{success:!1,error:"Not a roster page. Please navigate to the Scoutbook roster."};try{const t=await v();return!t||t.length<100?{success:!1,error:"Could not extract roster data. Is the page fully loaded?"}:{success:!0,html:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Extraction failed"}}}document.addEventListener("DOMContentLoaded",()=>{s()&&chrome.runtime.sendMessage({action:"pageReady",isRosterPage:!0,url:window.location.href})});let h=window.location.href;const A=new MutationObserver(()=>{window.location.href!==h&&(h=window.location.href,s()&&chrome.runtime.sendMessage({action:"pageReady",isRosterPage:!0,url:window.location.href}))});A.observe(document,{subtree:!0,childList:!0});console.log("[Chuckbox] Content script loaded");
