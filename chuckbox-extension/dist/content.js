function s(){const t=window.location.href.toLowerCase();return t.includes("advancements.scouting.org")&&(t.includes("/roster")||t.includes("/unit"))}function b(){x();const t=document.querySelector('main, .main-content, #content, [role="main"]');if(t)return t.innerHTML;const o=document.body.cloneNode(!0);return o.querySelectorAll("nav, header, footer, .navigation, .sidebar").forEach(n=>{n.remove()}),o.innerHTML}function x(){document.querySelectorAll("td[title], th[title]").forEach(e=>{const r=e.getAttribute("title");r&&r.trim()&&e.setAttribute("data-hover-text",r)}),document.querySelectorAll("[data-tooltip], [data-tip], [aria-label]").forEach(e=>{const r=e.getAttribute("data-tooltip")||e.getAttribute("data-tip")||e.getAttribute("aria-label");r&&r.trim()&&e.setAttribute("data-hover-text",r)}),document.querySelectorAll('.ant-tooltip-open, [class*="ant-tooltip"]').forEach(e=>{const r=e.querySelector(".ant-tooltip-inner");r&&e.setAttribute("data-hover-text",r.textContent||"")})}function w(){return[".ant-pagination",".ant-pagination-next",'[aria-label="pagination"]',".pagination",'[class*="pagination"]'].some(o=>document.querySelector(o)!==null)}function k(){const t=document.querySelector(".ant-pagination-next:not(.ant-pagination-disabled)");if(t&&t.getAttribute("aria-disabled")!=="true")return t;const o=['button[aria-label*="Next"]','a[aria-label*="Next"]','li[title="Next Page"]:not([aria-disabled="true"])',".pagination-next:not(.disabled)"];for(const n of o){const e=document.querySelector(n);if(e)return e}return null}function l(t){return new Promise(o=>setTimeout(o,t))}function m(){const t=document.querySelector(".ant-pagination-prev");if(t)return t.classList.contains("ant-pagination-disabled")||t.getAttribute("aria-disabled")==="true";const o=document.querySelector(".ant-pagination-item-active");return o?o.getAttribute("title")==="1":!0}async function v(){if(m()){console.log("[Chuckbox] Already on first page");return}console.log("[Chuckbox] Navigating to first page...");const t=document.querySelector(".ant-pagination-item-1");if(t){t.click(),await u(),await l(500),console.log("[Chuckbox] Clicked page 1 button");return}let o=20;for(;o>0&&!m();){const n=document.querySelector(".ant-pagination-prev:not(.ant-pagination-disabled)");if(!n||n.getAttribute("aria-disabled")==="true")break;n.click(),await u(),await l(300),o--}console.log("[Chuckbox] Navigated to first page")}function u(t=5e3){return new Promise(o=>{let n=!1;const e=new MutationObserver((r,a)=>{r.some(i=>{var h;const g=i.target,d=(h=g.tagName)==null?void 0:h.toLowerCase(),f=g.className||"";return i.type==="childList"&&(d==="tbody"||d==="table"||f.includes("ant-table")||f.includes("ant-spin"))})&&!n&&(n=!0,a.disconnect(),setTimeout(o,500))});e.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{n||(n=!0,e.disconnect(),o())},t)})}async function y(){const t=[];w()&&await v(),t.push(b()),console.log("[Chuckbox] Extracted page 1");let o=1;const n=20;for(;o<n;){const e=k();if(!e){console.log("[Chuckbox] No more pages (next button not found or disabled)");break}await l(300),console.log("[Chuckbox] Clicking next page..."),e.click(),await u(),await l(500);const r=b(),a=t[t.length-1];if(r.length===a.length&&r===a){console.log("[Chuckbox] Page content unchanged, stopping");break}o++,t.push(r),console.log(`[Chuckbox] Extracted page ${o}`)}return console.log(`[Chuckbox] Total pages extracted: ${t.length}`),t.join(`
<!-- PAGE BREAK -->
`)}function C(){var i;const t=document.body.innerText.match(/(\d+)\s*(?:member|scout|roster)/i),o=t?parseInt(t[1],10):null,n=document.querySelector('h1, h2, [class*="unit-name"], [class*="title"]'),e=((i=n==null?void 0:n.textContent)==null?void 0:i.trim())||null,r=document.body.innerText.match(/page\s*(\d+)\s*of\s*(\d+)/i),a=r?parseInt(r[1],10):null,c=r?parseInt(r[2],10):null;return{memberCount:o,unitName:e,pageNumber:a,totalPages:c}}chrome.runtime.onMessage.addListener((t,o,n)=>{if(t.action==="ping")return n({isRosterPage:s(),url:window.location.href}),!0;if(t.action==="getInfo"){const e=C();return n(e),!0}return t.action==="navigateToRoster"?(T().then(e=>n(e)).catch(e=>{n({success:!1,error:e instanceof Error?e.message:"Unknown error"})}),!0):t.action==="extract"?(P().then(e=>n(e)).catch(e=>{n({success:!1,error:e instanceof Error?e.message:"Unknown error"})}),!0):!1});async function P(){if(!s())return{success:!1,error:"Not a roster page. Please navigate to the Scoutbook roster."};try{const t=await y();return!t||t.length<100?{success:!1,error:"Could not extract roster data. Is the page fully loaded?"}:{success:!0,html:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Extraction failed"}}}async function T(){var n,e;if(s())return{success:!0};console.log("[Chuckbox] Looking for Roster navigation link...");const t=['a[href*="/roster"]','a[href*="roster"]','[class*="menu"] a:has-text("Roster")','[class*="nav"] a:has-text("Roster")','.ant-menu-item a[href*="roster"]','.ant-menu a[href*="roster"]','a:contains("Roster")','[role="navigation"] a[href*="roster"]','[role="menu"] a[href*="roster"]'];let o=null;for(const r of t)try{const a=document.querySelector(r);if(a){o=a,console.log(`[Chuckbox] Found roster link with selector: ${r}`);break}}catch{}if(!o){const r=document.querySelectorAll("a");for(const a of r){const c=((n=a.textContent)==null?void 0:n.trim().toLowerCase())||"",i=((e=a.getAttribute("href"))==null?void 0:e.toLowerCase())||"";if(c==="roster"||c.includes("roster")||i.includes("roster")){o=a,console.log("[Chuckbox] Found roster link by text/href search");break}}}return o?(console.log("[Chuckbox] Clicking roster link:",o.href),o.click(),await N(),s()?(console.log("[Chuckbox] Successfully navigated to roster page"),{success:!0}):{success:!1,error:"Navigation did not reach roster page. Please try again."}):{success:!1,error:"Could not find Roster link. Please navigate to the roster page manually."}}function N(t=1e4){return new Promise(o=>{const n=window.location.href;let e=!1;const r=setInterval(()=>{window.location.href!==n&&!e&&(e=!0,clearInterval(r),setTimeout(o,1e3))},100),a=new MutationObserver(()=>{s()&&!e&&(e=!0,clearInterval(r),a.disconnect(),setTimeout(o,500))});a.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{e||(e=!0,clearInterval(r),a.disconnect(),o())},t)})}document.addEventListener("DOMContentLoaded",()=>{s()&&chrome.runtime.sendMessage({action:"pageReady",isRosterPage:!0,url:window.location.href})});let p=window.location.href;const S=new MutationObserver(()=>{window.location.href!==p&&(p=window.location.href,s()&&chrome.runtime.sendMessage({action:"pageReady",isRosterPage:!0,url:window.location.href}))});S.observe(document,{subtree:!0,childList:!0});console.log("[Chuckbox] Content script loaded");
